# notice: update proxy provider in the `proxy-providers` section and `use` section.
# ref 1: https://wiki.metacubex.one/example/#meta
# ref 2: https://gist.github.com/liuran001/5ca84f7def53c70b554d3f765ff86a33

# ------------------------- templates -------------------------
pr:
  &pr {
    type: select,
    proxies: [èŠ‚ç‚¹é€‰æ‹©, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, DIRECT]
  }

p: &p
  type: http
  interval: 3600
  health-check:
    enable: true
    url: https://www.gstatic.com/generate_204
    expected-status: 204
    interval: 300
    timeout: 1000
    tolerance: 100


# ------------------------- proxy provider and config -------------------------
use: &use
  type: url-test  # or select
  use:
    - proxy-provider-1
    # - proxy-provider-2

proxy-providers:
  proxy-provider-1:
    <<: *p
    url: "https://your.subscription.com/should-be-filled-here"


# ------------------------- rule provider config -------------------------
rule-providers:
  # black list of ADs: https://github.com/privacy-protection-tools/anti-AD
  anti-AD:
    type: http
    behavior: domain
    format: yaml
    url: "https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-clash.yaml?"
    interval: 600

  # white list of ADs: https://github.com/privacy-protection-tools/dead-horse
  anti-AD-white:
    type: http
    behavior: domain
    format: yaml
    url: "https://raw.githubusercontent.com/privacy-protection-tools/dead-horse/master/anti-ad-white-for-clash.yaml?"
    interval: 600


# ------------------------- system config -------------------------
mode: rule
mixed-port: 7890
allow-lan: true
secret: ''
ipv6: true
bind-address: '*'
tcp-concurrent: true

log-level: info
unified-delay: true

find-process-mode: off # always, strict, off
keep-alive-interval: 1800
global-client-fingerprint: random
profile:
  store-selected: true
  store-fake-ip: true

external-controller: :9090
external-ui: /opt/clash/ui-xd
external-ui-name: xd


# ------------------------- dns and network config -------------------------
dns:
  enable: true
  ipv6: true
  listen: :1053
  use-system-hosts: false
  use-hosts: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  default-nameserver:
  - 223.5.5.5
  - 8.8.8.8
  - 119.29.29.29
  - 114.114.114.114
  - '[2402:4e00::]'
  - '[2400:3200::1]'
  nameserver:
  - https://doh.pub/dns-query
  - https://dns.alidns.com/dns-query
  - 'tls://8.8.4.4#dns'
  - 'tls://1.0.0.1#dns'
  - 'tls://[2001:4860:4860::8844]#dns'
  - 'tls://[2606:4700:4700::1001]#dns'
  proxy-server-nameserver:
  - https://doh.pub/dns-query
  nameserver-policy:
    "geosite:cn,private":
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query
  fallback:
  - https://doh.dns.sb/dns-query
  - https://dns.cloudflare.com/dns-query
  - https://dns.twnic.tw/dns-query
  - tls://8.8.4.4:853
  fallback-filter:
    geoip: true
    ipcidr:
    - 240.0.0.0/4
    - 0.0.0.0/32
  fake-ip-filter:
  - dns.msftncsi.com
  - www.msftncsi.com
  - www.msftconnecttest.com

tun:
  enable: false
  stack: gvisor
  device: Mihomo
  auto-route: true
  strict-route: false
  auto-detect-interface: true
  dns-hijack:
  - any:53
  - "tcp://any:53"
  mtu: 1500


# ------------------------- geo data config -------------------------
# Source https://github.com/MetaCubeX/meta-rules-dat
geodata-mode: true
geox-url:
  geoip: "https://hub.gitmirror.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://hub.gitmirror.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://hub.gitmirror.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"



proxy-groups:
  # å¦‚ä½¿ç”¨WARPéœ€æ‰‹åŠ¨åœ¨ä¸‹æ–¹çš„proxieså­—æ®µå†…æ·»åŠ  WARP, å¦‚ [WARP, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, DIRECT]
  - { name: èŠ‚ç‚¹é€‰æ‹©, type: select, proxies: [å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, DIRECT] }
  - { name: dns, <<: *pr }  # è¿™é‡Œçš„ dns æŒ‡æµ·å¤–è§£æ dns èµ°çš„èŠ‚ç‚¹ï¼Œä¸€èˆ¬è·ŸéšèŠ‚ç‚¹é€‰æ‹©å³å¯
  # - { name: WARPå‰ç½®, <<: *pr, exclude-type: "wireguard" }  # WARP é…ç½®é“¾å¼å‡ºç«™
  - { name: å¹¿å‘Šæ‹¦æˆª, type: select, proxies: [REJECT, DIRECT, èŠ‚ç‚¹é€‰æ‹©] }
  - { name: OpenAI, <<: *pr }
  - { name: Apple, <<: *pr }  # Apple æ¨èèµ°å…¨å±€ç›´è¿
  - { name: Google, <<: *pr }
  - { name: Telegram, <<: *pr }
  - { name: Twitter, <<: *pr }
  - { name: Pixiv, <<: *pr }
  - { name: YouTube, <<: *pr }
  - { name: NETFLIX, <<: *pr }
  - { name: Spotify, <<: *pr }
  - { name: Github, <<: *pr }
  - { name: Steam, <<: *pr }
  - { name: OneDrive, <<: *pr }
  - { name: å¾®è½¯æœåŠ¡, <<: *pr }
  - { name: å›½å†…, <<: *pr, proxies: [DIRECT, èŠ‚ç‚¹é€‰æ‹©, é¦™æ¸¯, å°æ¹¾, æ—¥æœ¬, æ–°åŠ å¡, ç¾å›½, å…¶å®ƒåœ°åŒº, å…¨éƒ¨èŠ‚ç‚¹, è‡ªåŠ¨é€‰æ‹©]}
  - { name: å…¶ä»–, <<: *pr }

  # åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - { name: é¦™æ¸¯, <<: *use, filter: "(?i)æ¸¯|hk|hongkong|hong kong" }
  - { name: å°æ¹¾, <<: *use, filter: "(?i)å°|tw|taiwan" }
  - { name: æ—¥æœ¬, <<: *use, filter: "(?i)æ—¥æœ¬|jp|japan" }
  - { name: ç¾å›½, <<: *use, filter: "(?i)ç¾|us|unitedstates|united states" }
  - { name: æ–°åŠ å¡, <<: *use, filter: "(?i)(æ–°|sg|singapore)" }
  - { name: å…¶å®ƒåœ°åŒº, <<: *use, filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*" }
  - { name: å…¨éƒ¨èŠ‚ç‚¹, <<: *use }
  - { name: è‡ªåŠ¨é€‰æ‹©, <<: *use, tolerance: 2, type: url-test }

rules:
  # è‹¥éœ€ç¦ç”¨ QUIC è¯·å–æ¶ˆæ³¨é‡Š QUIC ä¸¤æ¡è§„åˆ™, é˜²æ­¢ YouTube ç­‰ä½¿ç”¨ QUIC å¯¼è‡´é€Ÿåº¦ä¸ä½³, ç¦ç”¨ 443 ç«¯å£ UDP æµé‡ï¼ˆä¸åŒ…æ‹¬å›½å†…ï¼‰
  # - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOSITE,cn))),REJECT # quic
  - AND,((RULE-SET,anti-AD),(NOT,((RULE-SET,anti-AD-white)))),å¹¿å‘Šæ‹¦æˆª
  - GEOSITE,openai,OpenAI
  - GEOSITE,apple,Apple
  - GEOSITE,apple-cn,Apple
  - GEOSITE,github,Github
  - GEOSITE,twitter,Twitter
  - GEOSITE,youtube,YouTube
  - GEOSITE,google,Google
  - GEOSITE,google-cn,Google
  - GEOSITE,telegram,Telegram
  - GEOSITE,netflix,NETFLIX
  - GEOSITE,spotify,Spotify
  - GEOSITE,pixiv,Pixiv
  - GEOSITE,onedrive,OneDrive
  - GEOSITE,microsoft,å¾®è½¯æœåŠ¡
  - GEOSITE,geolocation-!cn,å…¶ä»–
  # - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOIP,CN))),REJECT # quic
  - GEOIP,google,Google
  - GEOIP,netflix,NETFLIX
  - GEOIP,telegram,Telegram
  - GEOIP,twitter,Twitter
  - GEOSITE,CN,å›½å†…
  - GEOIP,CN,å›½å†…
  - MATCH,å…¶ä»–
